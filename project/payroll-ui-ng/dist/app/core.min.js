app.service("deptService",["$http","$q",function(n,r){this.get=function(e){var t=r.defer();return n.post("/dept/".concat(e)).then(function(e){t.resolve(e.data)},function(e){console.log(e),t.reject("An error occured!")}),t.promise},this.add=function(e){var t=r.defer();return n.post("/dept/add",e).then(function(e){t.resolve(e.data)},function(e){console.log(e),t.reject("An error occured!")}),t.promise},this.update=function(e){var t=r.defer();return n.post("/dept/update",e).then(function(e){t.resolve(e.data)},function(e){t.reject("An error occured!")}),t.promise},this.getList=function(){var t=r.defer();return n.post("/dept/list").then(function(e){t.resolve(e.data)},function(e){t.reject("An error occured!")}),t.promise},this.getDepts=function(e){var t=r.defer();return n.post("/depts",e).then(function(e){t.resolve(e.data)},function(e){t.reject("An error occured!")}),t.promise}}]),app.service("postService",["$http","$q",function(n,r){this.add=function(e){var t=r.defer();return n.post("/post/add",e).then(function(e){t.resolve(e.data)},function(e){console.log(e),t.reject("An error occured!")}),t.promise},this.update=function(e){var t=r.defer();return n.post("/post/update",e).then(function(e){t.resolve(e.data)},function(e){console.log(e),t.reject("An error occured!")}),t.promise},this.get=function(e){var t=r.defer();return n.post("/post/".concat(e)).then(function(e){t.resolve(e.data)},function(e){console.log(e),t.reject("An error occured!")}),t.promise},this.getList=function(){var t=r.defer();return n.post("/post/list").then(function(e){t.resolve(e.data)},function(e){t.reject("An error occured!")}),t.promise},this.getPosts=function(e){var t=r.defer();return n.post("/posts",e).then(function(e){t.resolve(e.data)},function(e){t.reject("An error occured!")}),t.promise}}]),app.service("employeeService",["$http","$q",function(n,r){this.add=function(e){var t=r.defer();return n.post("/employee/add",e).then(function(e){t.resolve(e.data)},function(e){t.reject("An error occured!")}),t.promise},this.update=function(e){var t=r.defer();return n.post("/employee/update",e).then(function(e){t.resolve(e.data)},function(e){t.reject("An error occured!")}),t.promise},this.get=function(e){var t=r.defer();return n.post("/employee/".concat(e)).then(function(e){t.resolve(e.data)},function(e){t.reject("An error occured!")}),t.promise},this.getEmployees=function(e){var t=r.defer();return n.post("/employees",e).then(function(e){t.resolve(e.data)},function(e){t.reject("An error occured!")}),t.promise},this.getGenders=function(e){var t=[{id:"male",name:"Male"},{id:"female",name:"Female"},{id:"other",name:"Other"}];if(e)for(idx in e=e.toLowerCase(),t)if(t[idx].id==e)return t[idx];return t},this.getMaritalStatus=function(e){var t=[{id:"single",name:"Single"},{id:"married",name:"Married"},{id:"divorced",name:"Divorced"},{id:"separated",name:"Separated"}];if(e)for(idx in e=e.toLowerCase(),t)if(t[idx].id==e)return t[idx];return t}}]),app.service("benefitsService",["$http","$q",function(n,r){this.getList=function(){},this.add=function(e){var t=r.defer();return n.post("/benefit/add",e).then(function(e){t.resolve(e.data)},function(e){t.reject("An error occured!")}),t.promise},this.update=function(e){var t=r.defer();return n.post("/benefit/update",e).then(function(e){t.resolve(e.data)},function(e){t.reject("An error occured!")}),t.promise},this.get=function(e){var t=r.defer();return n.post("/benefit/".concat(e)).then(function(e){t.resolve(e.data)},function(e){t.reject("An error occured!")}),t.promise},this.getBenefits=function(e){var t=r.defer();return n.post("/benefits",e).then(function(e){t.resolve(e.data)},function(e){t.reject("An error occured!")}),t.promise},this.getType=function(e){var t=[{id:"benefit",name:"Benefit"},{id:"deduction",name:"Deduction"}];if(e)for(idx in e=e.toLowerCase(),t)if(t[idx].id==e)return t[idx];return t}}]),app.service("nhifService",["$http","$q",function(n,r){this.getList=function(){},this.add=function(e){var t=r.defer();return n.post("/nhif/add",e).then(function(e){t.resolve(e.data)},function(e){t.reject("An error occured!")}),t.promise},this.update=function(e){var t=r.defer();return n.post("/nhif/update",e).then(function(e){t.resolve(e.data)},function(e){t.reject("An error occured!")}),t.promise},this.getRates=function(e){var t=r.defer();return n.post("/nhif/rates",e).then(function(e){t.resolve(e.data)},function(e){t.reject("An error occured!")}),t.promise}}]),app.service("taxReliefService",["$http","$q",function(n,r){this.getList=function(){},this.add=function(e){var t=r.defer();return n.post("/taxrelief/add",e).then(function(e){t.resolve(e.data)},function(e){console.log(e),t.reject("An error occured!")}),t.promise},this.update=function(e){var t=r.defer();return n.post("/taxrelief/update",e).then(function(e){t.resolve(e.data)},function(e){console.log(e),t.reject("An error occured!")}),t.promise},this.getAll=function(e){var t=r.defer();return n.post("/taxrelief",e).then(function(e){t.resolve(e.data)},function(e){t.reject("An error occured!")}),t.promise}}]),app.service("payeService",["$http","$q",function(n,r){this.getList=function(){},this.add=function(e){var t=r.defer();return n.post("/paye/add",e).then(function(e){t.resolve(e.data)},function(e){t.reject("An error occured!")}),t.promise},this.update=function(e){var t=r.defer();return n.post("/paye/update",e).then(function(e){t.resolve(e.data)},function(e){t.reject("An error occured!")}),t.promise},this.getRates=function(e){var t=r.defer();return n.post("/paye/rates",e).then(function(e){t.resolve(e.data)},function(e){t.reject("An error occured!")}),t.promise}}]),app.service("roleService",["$http","$q",function(n,r){this.add=function(e){var t=r.defer();return n.post("/role/add",e).then(function(e){t.resolve(e.data)},function(e){t.reject("An error occured!")}),t.promise},this.update=function(e){var t=r.defer();return n.post("/role/update",e).then(function(e){t.resolve(e.data)},function(e){t.reject("An error occured!")}),t.promise},this.get=function(e){var t=r.defer();return n.post("/role/".concat(e)).then(function(e){t.resolve(e.data)},function(e){t.reject("An error occured!")}),t.promise},this.getList=function(){var t=r.defer();return n.post("/role/list").then(function(e){t.resolve(e.data)},function(e){t.reject("An error occured!")}),t.promise},this.getAll=function(e){var t=r.defer();return n.post("/roles",e).then(function(e){t.resolve(e.data)},function(e){t.reject("An error occured!")}),t.promise}}]),app.service("userService",["$http","$q",function(r,o){this.getList=function(){},this.get=function(e){var t=o.defer();return r.post("/user/".concat(e)).then(function(e){t.resolve(e.data)},function(e){console.log(e),t.reject("An error occured!")}),t.promise},this.add=function(e){var t=o.defer();return r.post("/user/add",e).then(function(e){t.resolve(e.data)},function(e){t.reject("An error occured!")}),t.promise},this.update=function(e){var t=o.defer();return r.post("/user/update",e).then(function(e){t.resolve(e.data)},function(e){t.reject("An error occured!")}),t.promise},this.getAll=function(e){var t=o.defer();return r.post("/users",e).then(function(e){t.resolve(e.data)},function(e){t.reject("An error occured!")}),t.promise},this.doAuth=function(e,t){var n=o.defer();return r.post("/login",{username:e,password:t}).then(function(e){n.resolve(e.data)},function(e){n.reject("An error occured!")}),n.promise}}]),app.service("periodService",["$http","$q",function(n,r){this.getList=function(){},this.closePeriod=function(e){var t=r.defer();return n.post("/period/"+e+"/close").then(function(e){t.resolve(e.data)},function(e){t.reject("An error occured!")}),t.promise},this.get=function(e){var t=r.defer();return n.post("/period/".concat(e)).then(function(e){t.resolve(e.data)},function(e){t.reject("An error occured!")}),t.promise},this.add=function(e){var t=r.defer();return n.post("/period/add",e).then(function(e){t.resolve(e.data)},function(e){t.reject("An error occured!")}),t.promise},this.update=function(e){var t=r.defer();return n.post("/period/update",e).then(function(e){t.resolve(e.data)},function(e){t.reject("An error occured!")}),t.promise},this.getAll=function(e){var t=r.defer();return n.post("/periods",e).then(function(e){t.resolve(e.data)},function(e){t.reject("An error occured!")}),t.promise},this.getStatus=function(){return[{id:"new",name:"New/Open"},{id:"closed",name:"Closed"}]}}]),app.service("payrollService",["$http","$q","employeeService",function(r,o,e){this.getList=function(){var t=o.defer();return r.post("/benefits/list").then(function(e){t.resolve(e.data)},function(e){t.reject("An error occured!")}),t.promise},this.addPayDetails=function(e){var t=o.defer();return r.post("/employee/pay/add",e).then(function(e){t.resolve(e.data)},function(e){console.log(e),t.reject("An error occured!")}),t.promise},this.updatePayDetails=function(e){var t=o.defer();return r.post("/employee/pay/update",e).then(function(e){t.resolve(e.data)},function(e){console.log(e),t.reject("An error occured!")}),t.promise},this.removeEmployeeBenefit=function(e,t){var n=o.defer();return r.delete("/employee/"+e+"/remove/benefit/"+t).then(function(e){n.resolve(e.data)},function(e){console.log(e),n.reject("An error occured!")}),n.promise},this.addEmployeeBenefit=function(e,t){var n=o.defer();return r.post("/employee/"+e+"/add/benefit/"+t).then(function(e){n.resolve(e.data)},function(e){console.log(e),n.reject("An error occured!")}),n.promise},this.getSalaryDetails=function(e){var t=o.defer();return r.post("/employee/"+e+"/payroll").then(function(e){t.resolve(e.data)},function(e){t.reject("An error occured!")}),t.promise},this.getEmployeeBenefits=function(e){var t=o.defer();return r.post("/employee/"+e+"/benefits").then(function(e){t.resolve(e.data)},function(e){t.reject("An error occured!")}),t.promise}}]),app.controller("payrollController",["$scope","$http","$state","$stateParams","$filter","payrollService",function(r,e,t,o,n,i){r.$parent.active=2,i.getSalaryDetails(o.id).then(function(e){r.employeeName=e.employee.surname+", "+e.employee.othernames,r.benefits=e.benefits,e.pay_details?r.pay={id:e.pay_details.id,salary:n("currency")(e.pay_details.salary,""),in_relief:n("currency")(e.pay_details.insurance_relief,"")}:(r.mask=!1,r.pay={salary:"0.00",in_relief:"0.00"})}),r.okHandle=function(){r.dialogMsgOpen=!1},r.submit=function(){$("body").LoadingOverlay("show");var e={employee:parseInt(o.id),salary:parseFloat(r.pay.salary.replace(",","")),insurance_relief:parseFloat(r.pay.in_relief.replace(",",""))};(r.pay.id?(e.id=parseInt(r.pay.id),i.updatePayDetails(e)):i.addPayDetails(e)).then(function(e){setTimeout(function(){$("body").LoadingOverlay("hide")},100)})},r.removeEmployeeBenefit=function(){var e=$("#benefits-tbl").getSelectedRow();if("{}"==JSON.stringify(e))r.dialogMsgOpen=!0,r.message="Please select row from table!";else{var t=o.id,n=e.id;i.removeEmployeeBenefit(t,n).then(function(e){$("#benefits-tbl").trigger("refresh")})}},r.addEmployeeBenefit=function(){var e=o.id;r.benefit&&(i.addEmployeeBenefit(e,r.benefit).then(function(e){$("#benefits-tbl").trigger("refresh")}),r.benefit=null)},r.customLoader=function(t,n,r){i.getEmployeeBenefits(o.id).then(function(e){n.pager.pages=1,r(t,e,n)})}}]),app.controller("benefitsController",["$scope","$http","$state","$filter","benefitsService",function(r,e,t,d,s){r.benefit_types=s.getType(),r.submit=function(){var e,t={name:r.name,amount:r.amt,descr:r.descr,deduct:r.type?"deduction"==r.type.id:"",taxable:"Yes"==r.taxable,active:"Yes"==r.active,percentage:"Yes"==r.perc},n=validate(t,{name:{name:"Name",required:!0},amount:{name:"Amount",required:!0,format:"currency"},deduct:{name:"Benefit/Deduction Type",required:!0}});n.isValid()?(t=$.extend(t,n.getSanitized()),console.log(t),e=r.id?(t.id=r.id,s.update(t)):s.add(t),$("body").LoadingOverlay("show"),e.then(function(e){r.dialogBenefitsOpen=!1,setTimeout(function(){$("body").LoadingOverlay("hide"),$("#benefits-tbl").trigger("refresh")},400)})):n.flushMessage("Benefit/Deduction")},r.cancelHandle=function(){r.dialogBenefitsOpen=!1},r.toolbars=function(){var e=$(document.createElement("BUTTON")).html("Add");return e.click(function(){r.$apply(function(){r.dialogBenefitsOpen=!0,r.name="",r.amt="",r.descr="",r.perc="No",r.deduct="",r.taxable="",r.active=""})}),[[e]]},r.dblClick=function(){var t=$(this).getRow();r.dialogBenefitsOpen=!0,s.get(t.id).then(function(e){r.id=t.id,r.name=e.name,r.amt=e.percentage?e.amount:d("currency")(e.amount,""),r.descr=e.descr,r.perc=e.percentage?"Yes":"No",r.type=s.getType(e.deduct?"deduction":"benefit"),r.taxable=e.taxable?"Yes":"No",r.active=e.active?"Yes":"No"})},r.customLoader=function(o,i,a){s.getBenefits(i.pager).then(function(e){var t;i.pager.pages=Math.ceil(e.count/i.pager.rows);var n=e.rows,r=[];for(idx in n)t=n[idx].percentage?n[idx].amount.toString().concat("%"):d("currency")(n[idx].amount,""),r.push({id:n[idx].id,name:n[idx].name,amount:t,deduct:n[idx].deduct?"Yes":"No",taxable:n[idx].taxable?"Yes":"No",active:n[idx].active?"Yes":"No"});e.rows=r,a(o,e,i)})}}]),app.controller("deptsController",["$scope","$http","$state","deptService",function(n,e,t,o){n.submit=function(){var e={alias:n.alias,descr:n.descr},t=validate(e,{alias:{name:"Alias",format:"alphaOrNumericOrBoth",required:!0}});t.isValid()?(e=$.extend(e,t.getSanitized()),n.id?(e.id=n.id,deptSrv=o.update(e)):deptSrv=o.add(e),$("body").LoadingOverlay("show"),deptSrv.then(function(e){n.dialogDeptOpen=!1,setTimeout(function(){$("body").LoadingOverlay("hide"),$("#depts-tbl").trigger("refresh")},400)})):t.flushMessage("Department")},n.cancelHandle=function(){n.dialogDeptOpen=!1},n.toolbars=function(){var e=$(document.createElement("BUTTON")).html("Add");return e.click(function(){n.$apply(function(){n.dialogDeptOpen=!0,n.id="",n.alias="",n.descr=""})}),[[e]]},n.dblClick=function(){var e=$(this).getRow();o.get(e.id).then(function(e){n.dialogDeptOpen=!0,n.id=e.id,n.alias=e.alias,n.descr=e.descr})},n.customLoader=function(t,n,r){o.getDepts(n.pager).then(function(e){n.pager.pages=Math.ceil(e.count/n.pager.rows),r(t,e,n)})}}]),app.controller("employeeController",["$scope","$state","$stateParams","employeeService","postService","$cookies",function(i,a,e,d,t,n){i.$parent.active=1,i.genders=d.getGenders(),i.maritalStatus=d.getMaritalStatus(),i.addNew=function(){i.id="",i.idno="",i.nssf="",i.nhif="",i.pin="",i.email="",i.mobile="",i.address="",i.marital_status=null,i.gender=null,i.post=null,i.surname="",i.othernames="",i.country="",i.city="",i.dob="",i.start_date="",i.end_date="",i.bank_details="",i.other_address="",i.other_email="",i.other_mobile="",i.active="",t.getList().then(function(e){i.posts=e})},Object.keys(e).includes("id")?d.get(e.id).then(function(t){console.log(t),i.id=e.id,i.idno=t.idno,i.nssf=t.nssf_no,i.nhif=t.nhif_no,i.pin=t.pin,i.email=t.email,i.mobile=t.mobile,i.address=t.address,i.surname=t.surname,i.othernames=t.othernames,i.country=t.country,i.city=t.city,i.dob=new Date(t.dob),i.start_date=new Date(t.start_date),i.end_date=new Date(t.end_date),i.bank_details=t.bank_details,i.other_address=t.other_address,i.other_email=t.other_email,i.other_mobile=t.other_mobile,i.active=t.status,i.posts=t.posts,i.post_=t.posts.find(function(e){return t.post==e.id}),i.marital_status=d.getMaritalStatus(t.marital_status),i.gender_=d.getGenders(t.gender)}):i.addNew(),i.submit=function(){var e=isObject(this.marital_status)?this.marital_status.name:this.marital_status,t=isObject(this.gender_)?this.gender_.id:this.gender_,n=isObject(this.post_)?this.post_.id:this.post_,r={idno:this.idno,nssf_no:this.nssf,nhif_no:this.nhif,pin:this.pin,email:this.email,mobile:this.mobile,status:this.active,address:this.address,surname:this.surname,othernames:this.othernames,country:this.country,city:this.city,dob:getShortDate(new Date(this.dob)),start_date:getShortDate(new Date(this.start_date)),end_date:getShortDate(new Date(this.end_date)),bank_details:this.bank_details,other_address:this.other_address,other_email:this.other_email,other_mobile:this.other_mobile,marital_status:e,gender:t,post:n},o=validate(r,{idno:{name:"IDNo",format:"number",len:7,required:!0},othernames:{name:"Other Names",format:"alpha",required:!0},surname:{name:"Surname",format:"alpha",required:!0},nssf_no:{name:"NSSF No.",format:"number",len:9,required:!0},nhif_no:{name:"NHIF No.",format:"number",len:7,required:!0},pin:{name:"PIN",format:"alphaNumericOnly",len:12,required:!0},email:{name:"Email",format:"email",required:!0},mobile:{name:"Mobile Number",required:!0},marital_status:{name:"Marital Status",required:!0},gender:{name:"Gender",required:!0},dob:{name:"Date of Birth",required:!0},start_date:{name:"Start Date",required:!0},end_date:{name:"End Date",required:!0},post:{name:"Post",required:!0},bank_details:{name:"Bank Details",required:!0}});o.isValid()?(r=$.extend(r,o.getSanitized()),console.log(r),i.id?(r.id=i.id,empSrv=d.update(r)):empSrv=d.add(r),$("body").LoadingOverlay("show"),empSrv.then(function(e){setTimeout(function(){isEmpty(e.id)||a.go("employee.details",{id:e.id}),$("body").LoadingOverlay("hide")},500)})):o.flushMessage("Employee")}}]),app.controller("employeesController",["$scope","$http","$httpBackend","$state","employeeService",function(e,t,n,r,o){e.toolbars=function(){var e=$(document.createElement("BUTTON")).html("Add");return e.click(function(){r.go("employee-add")}),[[e]]},e.dblClick=function(){var e=$(this).getRow();r.go("employee.details",{id:e.id})},e.customLoader=function(t,n,r){o.getEmployees(n.pager).then(function(e){n.pager.pages=Math.ceil(e.count/n.pager.rows),r(t,e,n)})}}]),app.controller("loginController",["$scope","$http","userService",function(t,e,n){t.login={username:"sa",password:"p@55w0rd"},t.okHandle=function(){t.dialogMsgOpen=!1},t.submit=function(){$("body").LoadingOverlay("show"),setTimeout(function(){$("body").LoadingOverlay("hide"),n.doAuth(t.login.username,t.login.password).then(function(e){e.isLoggedIn?t.dialogLoginOpen=!1:(t.message="Invalid Credentials!",t.dialogMsgOpen=!0)})},1e3)}}]),app.controller("periodController",["$scope","$http","periodService",function(r,e,i){r.status=i.getStatus(),r.addNew=function(){r.start_date="",r.end_date="",r.period_status="New",r.descr="",r.active="No"},r.submit=function(){var e,t={start:isNull(r.start_date)?"":new Date(r.start_date).toDateString(),end:isNull(r.end_date)?"":new Date(r.end_date).toDateString(),status:"New"==r.period_status?"Open":r.period_status,descr:r.descr,active:"Yes"==r.active},n=validate(t,{start:{name:"Start Date",required:!0},end:{name:"End Date",required:!0}});n.isValid()?(t=$.extend(t,n.getSanitized()),e=r.id?(t.id=r.id,i.update(t)):i.add(t),$("body").LoadingOverlay("show"),e.then(function(e){r.dialogPeriodOpen=!1,setTimeout(function(){$("body").LoadingOverlay("hide"),$("#period-tbl").trigger("refresh")},400)})):n.flushMessage("Period")},r.cancelHandle=function(){r.dialogPeriodOpen=!1},r.okConfirmPeriodHandle=function(){var e=$("#period-tbl").getSelectedRow();r.dialogConfirmPeriodOpen=!1,$("body").LoadingOverlay("show"),i.closePeriod(e.id).then(function(e){$("body").LoadingOverlay("hide"),$("#period-tbl").trigger("refresh")})},r.cancelConfirmPeriodHandle=function(){r.dialogConfirmPeriodOpen=!1},r.okMsgPeriodHandle=function(){r.dialogMsgPeriodOpen=!1},r.toolbars=function(){var e=$(document.createElement("BUTTON")).html("Add");e.click(function(){r.$apply(function(){r.dialogPeriodOpen=!0,r.addNew()})});var t=$(document.createElement("BUTTON")).html("Close");return t.click(function(){var e=$("#period-tbl").getSelectedRow();r.$apply(function(){"{}"==JSON.stringify(e)?(r.dialogMsgPeriodOpen=!0,r.messagePeriod="Please select period from grid!"):(r.dialogConfirmPeriodOpen=!0,r.confirmPeriod="Are you sure you want to close period?")})}),[[e,t]]},r.dblClick=function(){var e=$(this).getRow();i.get(e.id).then(function(e){r.dialogPeriodOpen=!0,r.start_date=new Date(e.start),r.end_date=new Date(e.end),r.period_status=e.status,r.descr=e.descr,r.active=e.active?"Yes":"No"})},r.customLoader=function(n,r,o){i.getAll(r.pager).then(function(e){r.pager.pages=Math.ceil(e.count/r.pager.rows);var t=e.rows;for(idx in t)t[idx].active=t[idx].active?"Yes":"No";o(n,e,r)})}}]),app.controller("postsController",["$scope","$http","$state","postService","deptService",function(r,e,t,a,n){r.cancelHandle=function(){r.dialogPostOpen=!1},r.submit=function(){console.log(r.dept);var e,t={name:r.name,descr:r.descr,dept:r.dept},n=validate(t,{name:{name:"Name",format:"alphaOrNumericOrBoth",required:!0},dept:{name:"Department Name",required:!0}});n.isValid()?(t=$.extend(t,n.getSanitized()),e=r.id?(t.id=r.id,a.update(t)):a.add(t),$("body").LoadingOverlay("show"),e.then(function(e){r.dialogPostOpen=!1,setTimeout(function(){$("body").LoadingOverlay("hide"),$("#posts-tbl").trigger("refresh")},400)})):n.flushMessage("Post")},r.toolbars=function(){var e=$(document.createElement("BUTTON")).html("Add");return e.click(function(){r.$apply(function(){r.dialogPostOpen=!0,r.id="",r.name="",r.descr="",r.dept=null,n.getList().then(function(e){r.depts=e})})}),[[e]]},r.dblClick=function(){var e=$(this).getRow();a.get(e.id).then(function(e){for(idx in r.dialogPostOpen=!0,r.id=e.id,r.name=e.name,r.descr=e.descr,r.depts=e.depts,e.depts)e.depts[idx].id==e.dept_id&&(r.dept=e.depts[idx])})},r.customLoader=function(r,o,i){a.getPosts(o.pager).then(function(e){o.pager.pages=Math.ceil(e.count/o.pager.rows);var t=e.rows,n=[];for(idx in t)n.push({id:t[idx].id,name:t[idx].name,dept_name:t[idx].dept_name,dept_id:t[idx].dept_id});e.rows=n,i(r,e,o)})}}]),app.controller("rolesController",["$scope","$http","roleService",function(r,e,o){r.cancelHandle=function(){r.dialogRoleOpen=!1},r.submit=function(){var e,t={name:r.name,descr:r.descr},n=validate(t,{name:{name:"Name",required:!0}});n.isValid()?(t=$.extend(t,n.getSanitized()),e=r.id?(t.id=r.id,o.update(t)):o.add(t),$("body").LoadingOverlay("show"),e.then(function(e){r.dialogRoleOpen=!1,setTimeout(function(){$("body").LoadingOverlay("hide"),$("#roles-tbl").trigger("refresh")},400)})):n.flushMessage("Roles")},r.toolbars=function(){var e=$(document.createElement("BUTTON")).html("Add");return e.click(function(){r.$apply(function(){r.dialogRoleOpen=!0,r.id="",r.name="",r.descr=""})}),[[e]]},r.dblClick=function(){var e=$(this).getRow();o.get(e.id).then(function(e){r.dialogRoleOpen=!0,r.id=e.id,r.name=e.name,r.descr=e.descr})},r.customLoader=function(t,n,r){o.getAll(n.pager).then(function(e){n.pager.pages=Math.ceil(e.count/n.pager.rows),r(t,e,n)})}}]),app.controller("usersController",["$scope","$http","userService","roleService",function(o,e,i,t){o.addNew=function(){o.id="",o.username="",o.role=null,o.password="",o.lpassword="",o.cpassword="",t.getList().then(function(e){o.roles=e,o.role=null})},o.submit=function(){var e={username:o.username,role:o.role,password:o.password,lpassword:o.lpassword,cpassword:o.cpassword},t={username:{name:"Username",format:"alphaOrNumericOrBoth",required:!0},password:{name:"New Password",required:!0},cpassword:{name:"Confirm Password",required:!0},role:{name:"Role",required:!0}};o.id&&(t=$.extend({},{lpassword:{name:"Current Password",required:!0}},t));var n,r=validate(e,t);r.isValid()?(e=r.getSanitized()).cpassword.equalTo(e.password)?(n=o.id?(e.id=o.id,i.update(e)):i.add(e),$("body").LoadingOverlay("show"),n.then(function(e){e.message?($.growl({title:"User",message:e.message}),$("body").LoadingOverlay("hide")):setTimeout(function(){$("body").LoadingOverlay("hide"),$("#user-tbl").trigger("refresh")},400),o.dialogUserOpen=!1})):$.growl({title:"User",message:"New Password and Confirm Password do not match!"}):r.flushMessage("User")},o.cancelMsgHandle=function(){o.dialogMsgOpen=!1},o.cancelResetPassHandle=function(){o.dialogResetPassOpen=!1},o.cancelUserHandle=function(){o.dialogUserOpen=!1},o.okHandle=function(){o.dialogResetPassOpen=!1},o.toolbars=function(){var e=$(document.createElement("BUTTON")).html("Add");e.click(function(){o.$apply(function(){o.dialogUserOpen=!0,o.addNew()})});var t=$(document.createElement("BUTTON")).html("Reset");return t.click(function(){o.$apply(function(){0<$("tr.selected").length?(o.message="Are you sure you want to continue with this action?",o.dialogResetPassOpen=!0):(o.infomessage="Please select a row in the grid.",o.dialogMsgOpen=!0)})}),[[e,t]]},o.dblClick=function(){var e=$(this).getRow();i.get(e.id).then(function(e){for(idx in o.dialogUserOpen=!0,o.id=e.id,o.username=e.username,o.lpassword="",o.cpassword="",o.password="",o.roles=e.roles,e.roles)e.roles[idx].id==e.role&&(o.role=e.roles[idx])})},o.customLoader=function(t,n,r){i.getAll(n.pager).then(function(e){n.pager.pages=Math.ceil(e.count/n.pager.rows),r(t,e,n)})}}]),app.controller("payeController",["$scope","$http","$state","$filter","payeService",function(r,e,t,i,a){r.$parent.active=2,r.addNew=function(){r.disableNew=!0,r.id="",r.ubound="",r.lbound="",r.tax_rate=""},r.submit=function(){var e,t={ubound:r.ubound,lbound:r.lbound,rate_perc:r.tax_rate},n=validate(t,{lbound:{name:"Lower Bound",format:"currency",required:!0},ubound:{name:"Upper Bound",format:"currency",required:!0},rate_perc:{name:"Rate",format:"number",range:{from:1,to:100},required:!0}});n.isValid()?(t=n.getSanitized(),e=r.id?(t.id=r.id,a.update(t)):a.add(t),$("body").LoadingOverlay("show"),e.then(function(e){setTimeout(function(){$("body").LoadingOverlay("hide"),$("#paye-tbl").trigger("refresh"),r.addNew()},400)})):n.flushMessage("PAYE")},r.dblClick=function(){var e=$(this).getRow();r.$apply(function(){r.disableNew=!1,r.id=e.id,r.ubound=e.ubound,r.lbound=e.lbound,r.tax_rate=e.rate_perc.replace("%","")})},r.customLoader=function(n,r,o){a.getRates(r.pager).then(function(e){r.pager.pages=Math.ceil(e.count/r.pager.rows);var t=e.rows;for(idx in t)t[idx].lbound=i("currency")(t[idx].lbound,""),t[idx].ubound=i("currency")(t[idx].ubound,""),t[idx].rate_perc=t[idx].rate_perc+"%";e.rows=t,o(n,e,r)})}}]),app.controller("nhifController",["$scope","$http","$state","$stateParams","$filter","nhifService",function(r,e,t,n,a,d){r.$parent.active=1,r.submit=function(){var e,t={id:r.id,lbound:r.lbound,ubound:r.ubound,amt:r.amount},n=validate(t,{lbound:{name:"Lower Bound",format:"currency",required:!0},ubound:{name:"Upper Bound",format:"currency",required:!0},amt:{name:"Amount",format:"currency",required:!0}});n.isValid()?(t=n.getSanitized(),e=r.id?(t.id=r.id,d.update(t)):d.add(t),$("body").LoadingOverlay("show"),e.then(function(e){setTimeout(function(){$("body").LoadingOverlay("hide"),$("#nhif-tbl").trigger("refresh"),r.addNew()},400)})):n.flushMessage("NHIF")},r.addNew=function(){r.disableNew=!0,r.id="",r.lbound="",r.ubound="",r.amount=""},r.dblClick=function(){var e=$(this).getRow();r.$apply(function(){r.disableNew=!1,r.id=e.id,r.lbound=e.lbound,r.ubound=e.ubound,r.amount=e.amt})},r.customLoader=function(r,o,i){d.getRates(o.pager).then(function(e){o.pager.pages=Math.ceil(e.count/o.pager.rows);var t=e.rows,n=[];for(idx in t)n.push({id:t[idx].id,lbound:a("currency")(t[idx].lbound,""),ubound:a("currency")(t[idx].ubound,""),amt:a("currency")(t[idx].amt,"")});e.rows=n,i(r,e,o)})}}]),app.controller("taxReliefController",["$scope","$http","$state","$filter","taxReliefService",function(r,e,t,i,a){r.$parent.active=3,r.submit=function(){var e,t={name:r.name,amt:r.amount,active:"Yes"==r.active},n=validate(t,{name:{name:"Name",format:"alphaOrNumericOrBoth",required:!0},amt:{name:"Amount",format:"currency",required:!0}});n.isValid()?(t=$.extend(t,n.getSanitized()),e=r.id?(t.id=r.id,a.update(t)):a.add(t),$("body").LoadingOverlay("show"),e.then(function(e){setTimeout(function(){$("body").LoadingOverlay("hide"),$("#relief-tbl").trigger("refresh"),r.addNew()},400)})):n.flushMessage("Tax Relief")},r.addNew=function(){r.newDisable=!0,r.id="",r.name="",r.amount="",r.active="No"},r.dblClick=function(){var e=$(this).getRow();r.$apply(function(){r.newDisable=!1,r.id=e.id,r.name=e.name,r.amount=e.amount,r.active=e.active})},r.customLoader=function(n,r,o){a.getAll(r.pager).then(function(e){r.pager.pages=Math.ceil(e.count/r.pager.rows);var t=e.rows;for(idx in t)t[idx].amount=i("currency")(t[idx].amount,""),t[idx].active=t[idx].active?"Yes":"No";e.rows=t,o(n,e,r)})}}]);